Updated File:
For somereason SP is not integrating S_opt numerically, the code doesn't halt 
